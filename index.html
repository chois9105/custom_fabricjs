<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<link rel="stylesheet" type="text/css" href="./css/reset.css" />
<link rel="stylesheet" type="text/css" href="./css/customFabric.css" />

<script src="./js/jquery-1.10.2.js"></script>
<script src="./js/fabric.js"></script>
<script src="./js/fabric.canvasex.js "></script>
<script src="./js/fabric.custom.js"></script>
<script src="./js/call.oembed.js"></script>

<title>image editor</title>


<script type="text/javascript">
$(function(){

// start init canvas(width, height) 
	var canvas = new fabric.CanvasEx('c');
	var customFabric = new CustomFabric();
	var editorWidth = $(".editor_wrapper").width();
	var editorHeight = $(".editor_wrapper").height();
	
	canvas.setWidth(editorWidth);
	canvas.setHeight(editorHeight);
	canvas.renderAll();


	customFabric.setCanvas(canvas);	
	customFabric.setTextPannel('#textPannel');
	customFabric.setFigurePannel('#figurePannel');
	customFabric.resizeCanvas('#editorWrapper');
	
// end initCanvas 

	$("div.load_images .btn_loadimage").click(function(){

		var imageURL = $(".load_images .imageURL").val()
		customFabric
		.withURL(imageURL)
		.loadImage(function(data){

			var thumbnail_url = data.thumbnail_url;
			thumbnail_url = thumbnail_url.replace("http://","");
/*
			$.get('http://www.corsproxy.com/' + thumbnail_url, function(response) {

				fabric.Image.fromObject(response, function(oImg) {

					oImg.set({
						width: Math.round(editorWidth / 2),
						height: Math.round(editorHeight / 2),				
					});

					canvas.clear();
					canvas.add(oImg);	
					canvas.renderAll();
					oImg.center();				
					oImg.setCoords();
				});

				
			});
*/
			

		});

	});

	$(".btn_rotate").click(function(){
		customFabric.rotateObject(90);
	});

	
	$(".btn_rotateSymmentry").click(function(){
		customFabric.rotateSymmetry();		

	});

	$(".btn_upScale").click(function(){
		customFabric.upScale(0.2);		
	});

	$(".btn_downScale").click(function(){
		customFabric.downScale(-0.2);		
	});


	$(".btn_addCircle").click(function(){

		customFabric.addCircle({
			radius : 40,
			fill : 'black',
			width : 100,
			height : 100,
			top : 100,
			left : 100,
			opacity: 1,
			scaleX: 1,
			scaleY: 1,		
		});

	});

	$(".btn_addRect").click(function(){

		customFabric.addRect({
			fill : 'black',
			width : 100,
			height : 100,
			top : 100,
			left : 100,
			opacity: 1,
			scaleX: 1,
			scaleY: 1,		
		});

	});

	
	$(".btn_addTriangle").click(function(){

		customFabric.addTriangle({
			radius : 40,
			fill : 'black',
			width : 100,
			height : 100,
			top : 100,
			left : 100,
			opacity: 1,
			scaleX: 1,
			scaleY: 1,		
		});

	});


	// imgObject must exist
	$(".btn_img_croparea").click(function(){
		customFabric.showImgCropArea();
	});


	// imgObject must exist
	$(".btn_up_brightness").click(function(){
		customFabric.changeBrightness(10);
	});

	// imgObject must exist
	$(".btn_up_brightness").click(function(){
		customFabric.changeBrightness(10);
	});

	// imgObject must exist
	$(".btn_down_brightness").click(function(){
		customFabric.changeBrightness(-10);
	});


	$(".btn_loadimage").click();



})


	

</script>

</head>
<body>

<div class="editorContainer">
	<div class="iconWrap">

		<span class="photoButton btn_rotate">rotate(90)</span>
		<span class="photoButton btn_rotateSymmentry">rotate_symmetry</span>
		
		<span class="photoButton btn_upScale">scale_up(0.2)</span>
		<span class="photoButton btn_downScale">scale_down(-0.2)</span>

		<span class="photoButton btn_addCircle">canvas_circle</span>
		<span class="photoButton btn_addRect">canvas_rect</span>	
		<span class="photoButton btn_addTriangle">canvas_triangle</span>
		<span class="photoButton btn_addText">canvas_text</span>
	 

		<span class="photoButton btn_img_croparea">crop_Area</span>


		<span class="photoButton btn_change_grayscale">change_grayscale</span>
		<span class="photoButton btn_up_brightness">up_brightness</span>
		<span class="photoButton btn_down_brightness">down_brightness</span>

	</div>

	<div class="textPannel" id="textPannel">
		<textarea class='textBody'></textarea>
	</div>

	<div class="figurePannel" id="figurePannel">
		
	</div>


	<div class="load_images">
		<input value="./images/Tulips.jpg" class="imageURL" />
		<button class="btn_loadimage">불러오기</button>

	</div>


	<div id="editorWrapper" class="editor_wrapper">
		<canvas id="c" style="position:absolute;margin: 0 0 0 0; padding:0; height:auto"></canvas> 
	</div>

</div>

</body>

</html>